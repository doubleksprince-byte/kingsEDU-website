<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Comprehension Quiz Game</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron&family=Roboto:wght@400;700&display=swap');
  body, html {
    
    margin: 0; padding: 0;
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(135deg, #050a30, #12002b);
    color: #eee;
    height: 100vh;
    overflow: hidden;
  }
  
  #app {
    display: flex;
    height: 100vh;
    flex-direction: column;
  }
  /* Start Screen */
  #startScreen {
    flex: 1;
    background: #00091a;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #7fffd4;
    position: relative;
    overflow: hidden;
  }
    
 #astronaut {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: url('https://i.pinimg.com/originals/93/50/55/935055c542ec90cd73007a64f4e898d9.gif') center center / cover no-repeat;
  opacity: 0.2;
  animation: fadeOut 10s linear forwards;
  z-index: 10; /* ‚¨Ö Bring it above background, but still behind text */
  pointer-events: none;
}

  
 /* Fade-out animation */
  @keyframes fadeOut {
    from {
      opacity: 0.2;
    }
    to {
      opacity: 0;
    }
    
  }
  
  /* Subtle rocket sound (handled in JS) */

  #nameInput {
    font-size: 1.4rem;
    padding: 16px 20px;
    border-radius: 17px;
    border: none;
    width: 320px;
    max-width: 90vw;
    margin-bottom: 16px;
  }
  #startBtn {
    padding: 14px 32px;
    font-size: 1.3rem;
    background: linear-gradient(90deg, #0055ff, #7700ff);
    border: none;
    border-radius: 20px;
    color: white;
    cursor: pointer;
    transition: box-shadow 0.3s ease;
  }
  #startBtn:hover:not(:disabled) {
    box-shadow: 0 0 15px #7700ff;
  }
  #startBtn:disabled {
    background: #555;
    cursor: not-allowed;
  }

 /* Main Quiz Layout */
#quizContainer {
  flex: 1;
  display: flex;
  background: #0c0c1f;
  overflow: hidden;
}

/* üü¶ Passage: now 60% of the screen */
#passageText {
  width: 65%;
  padding: 85px 95px;
  overflow-y: auto;
  border-right: 2px solid #333;
  font-size: 1.22rem;
  line-height: 1.55;
  box-sizing: border-box;
  color: #eee;
}

/* üü¶ Questions: now 50%, with progress bar above */
#questionArea {
  width: 40%;
  padding: 20px 25px;
  display: flex;
  flex-direction: column;
}

/* üîº Progress Bar moved higher */
#progressBarContainer {
  height: 15px;
  width: 20%;
  background: #222;
  border-radius: 15px;
  margin-bottom: 20px;
  box-shadow: inset 0 0 6px #000;
}

#progressBarFill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #0055ff, #7700ff);
  border-radius: 15px;
  transition: width 0.4s ease;
  box-shadow: 0 0 10px #7700ff;
}

/* Question */
#questionNumber {
  font-weight: 700;
  font-size: 1.3rem;
  margin-bottom: 10px;
}
#questionText {
  font-size: 1.15rem;
  margin-bottom: 18px;
}

#optionsContainer {
  flex-grow: 1;
}
/* Style for the selected button */
button.optionBtn.optionSelected {
  background-color: #007bff;  /* Blue background */
  color: white;  /* White text */
  border: 2px solid #0056b3;  /* Dark blue border */
}

/* Style for the enlarged button */
button.optionBtn.enlarged {
  transform: scale(1.1);  /* Enlarge the button */
  transition: transform 0.3s ease;  /* Smooth transition */
}

/* Optional: Style for all buttons */
button.optionBtn {
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
  border: 2px solid #ccc;  /* Light border initially */
  margin: 5px;
  transition: all 0.3s ease;
}

button.optionBtn:hover {
  background-color: #f0f0f0;
}

/* ‚¨ÜÔ∏è Option Buttons: Taller, cleaner */
#optionsContainer button.optionBtn {
  width: 100%;
  min-height: 70px; /* Taller buttons */
  margin-bottom: 14px;
  font-size: 1.15rem;
  font-weight: 600;
  border-radius: 14px;
  border: none;
  background-image: linear-gradient(90deg, #0055ff, #7700ff);
  color: #ddd;
  cursor: pointer;
  transition: background-color 0.3s ease, color 0.3s ease;
  user-select: none;
}

#optionsContainer button.optionBtn:hover {
  filter: brightness(1.15);
}

#optionsContainer button.optionBtn.optionSelected {
  color: white !important;
  background-image: linear-gradient(90deg, #7700ff, #0055ff);
  box-shadow: 0 0 12px #7700ff;
}

/* ‚è≠Ô∏è Controls ‚Äî bigger next/same buttons */
#controls {
  margin-top: 20px;
  display: flex;
  justify-content: center;
  gap: 20px;
}

#controls button {
  background: linear-gradient(90deg, #0055ff, #7700ff);
  border: none;
  border-radius: 20px;
  padding: 12px 26px;
  color: white;
  font-weight: 700;
  font-size: 1.1rem;
  cursor: pointer;
  transition: box-shadow 0.3s ease;
}
/* Add this inside your existing <style> in <head> */
#feedbackList {
  max-height: 400px;
  overflow-y: auto;
  padding-right: 8px;
}
.feedbackItem.correct {
  background-color: #e6ffe6;
}
.feedbackItem.incorrect {
  background-color: #ffe6e6;
}

#controls button:hover {
  box-shadow: 0 0 12px #7700ff;
}

#controls button:disabled {
  background: #444;
  cursor: not-allowed;
  box-shadow: none;
}

  /* Responsive */
  @media (max-width: 900px) {
    #quizContainer {
      flex-direction: column;
    }
    #passageText, #questionArea {
      width: 100%;
      height: 45vh;
    }
  }
</style>
</head>
<body>

<div id="app">

  <!-- START SCREEN -->
<section id="startScreen">
  <!-- Astronaut background -->
  <div id="astronaut" title="Astronaut launching..."></div>

  <!-- Main quiz title -->
  <h1>Comprehension Quiz Game</h1>

  <!-- Name input and start button -->
  <input type="text" id="nameInput" placeholder="Enter your name" autocomplete="off" />
  <button id="startBtn" disabled>Start Quiz</button>

  <!-- Sound effect -->
  <audio id="rocketSound" src="https://actions.google.com/sounds/v1/space/rocket_launch_countdown_beeps.ogg" preload="auto"></audio>
</section>


  <!-- QUIZ CONTAINER (hidden initially) -->
  <section id="quizContainer" style="display:none;">
    <div id="passageText" aria-label="Passage Text" tabindex="0">
      </style>
<div style="text-align: center; margin-bottom: 1em;">
  <h1 style="font-size: 2em; font-weight: bold; margin: 0;">Everyday Use</h1>
  <p style="font-size: 1.1em; margin: 0.2em 0 0;">by Alice Walker</p>
</div>
      <p>I will wait for her in the yard that Maggie and I made so clean and wavy yesterday afternoon. A yard like this is more comfortable than most people know. It is not just a yard. It is like an extended living room. Maggie will be nervous until after her sister goes: she will stand hopelessly in corners, homely and ashamed of the burn scars down her arms and legs, eyeing her sister with a mixture of envy and awe.</p>
      <p>She thinks her sister has held life always in the palm of one hand, that "no" was a word the world never learned to say to her.</p>
      <p><em>"How do I look, Mama?"</em> Maggie says, showing just enough of her thin body enveloped in a pink skirt and red blouse for me to know she's there, almost hidden by the door.</p>
      <p>"Come out into the yard," I say.</p>
      <p>Have you ever seen a lame animal, perhaps a dog run over by some careless person rich enough to own a car, sidle up to someone who is ignorant enough to be kind to him? That is the way my Maggie walks. She has been like this, chin on chest, eyes on the ground, feet in shuffle, ever since the fire that burned the other house to the ground. How long ago was it that the other house burned? Ten, twelve years? Sometimes I could still hear the flames and feel Maggie's arms sticking up to me, her hair smoking and her dress falling off her in little black papery flakes. And Dee. I see her standing off under the sweet gum tree she used to dig gum out of; a look of concentration on her face as she watched the last dingy gray boards of the house fall in towards the red-hot brick chimney. Why don't you do a dance around the ashes? I'd wanted to ask her. She had hated the house that much.</p>
      <p>I used to think she hated Maggie, too. But that was before we raised the money, the church and me, to send her to Augusta to school. She used to read to us without pity; forcing words, lies, other folks' habits, whole lives upon us two, sitting trapped and ignorant underneath her voice. She washed us in a river of make-believe, burned us with a lot of knowledge we didn't necessarily need to know.</p>
      <p>Dee wanted nice things. A yellow organdy dress to wear to her graduation from high school; black pumps to match a green suit she'd made from an old suit somebody gave me. She was determined to stare down any disaster in her efforts.</p>
      <p>When she comes I will meet - but there they are!</p>
      <p>Maggie attempts to make a dash for the house, in her shuffling way but I stay her with a hand. "Come back here." She stops and tries to dig a well in the sand with her toe. It is hard to see them clearly, but even the first glimpse of leg out of the car tells me it is Dee. Her feet were always neat-looking, as if God himself had shaped them. From the other side comes a short, stocky man. His hair is all over his head a foot long and hanging from his chin like a kinky mule tail.</p>
      <p>"Well," I say. "Dee."</p>
      <p>"No, Mama," she says. "Not 'Dee'. Wangero Leewanika Kemanjo."</p>
      <p>"What happened to 'Dee'?" I wanted to know.</p>
      <p>"She's dead," Wangero said. "I couldn't bear it any longer, being named after the people who oppressed me."</p>
      <p>"You know as well as me you was named after your aunt Dicie," I said. "Dicie is my sister. She named you."</p>
      <p>"Why shouldn't I? If that's what you want us to call you, we'll call you. Ream it out again." Well, soon we got the name out of the way.</p>
      <span><b><div> Adapted from Alice Walker, "Everyday Use". In literature: Craft & Voice, Vol. 1, Fiction, pp. 608-611.</div></b></span>
    </div>
    <div id="progressBarContainer" aria-label="Quiz progress">
      <div id="progressBarFill"></div>
      <div id="progressWrapper">
  <div id="progressBar">
    <div id="progressBarFill">
      <span id="progressStar">‚≠ê</span>
    </div>
    <span id="progressStar">üèÅ</span>
  </div>
</div>

    </div>
    <div id="questionArea" aria-live="polite" aria-atomic="true">
      <div id="questionNumber"></div>
      <div id="questionText"></div>
      <div id="optionsContainer"></div>
      <div id="controls">
        <button id="backBtn" disabled>Back</button>
        <button id="saveBtn">Save</button>
        <button id="nextBtn" disabled>Next</button>
        <button id="resetBtn">Reset</button>
        <button id="submitBtn" style="display:none;background:#7700ff;">Submit</button>
      </div>
    </div>
  </section>

  <!-- RESULT SCREEN -->
  <section id="resultScreen" style="display:none;">
    <h2>Quiz Results</h2>
    <div id="scoreSummary"></div>
    <div id="feedbackList"></div>
    <div style="text-align:center; margin-top: 25px;">
      <button id="downloadPdfBtn">Download PDF Report</button>
    </div>
  </section>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
 (() => {
  const { jsPDF } = window.jspdf;

  // Declare globally accessible score variables
  let totalScore = 0;
  let maxScore = 0;

  // ... rest of your code ..

    // Elements
    const startScreen = document.getElementById('startScreen');
    const astronaut = document.getElementById('astronaut');
    const rocketSound = document.getElementById('rocketSound');
    const nameInput = document.getElementById('nameInput');
    const startBtn = document.getElementById('startBtn');

    const quizContainer = document.getElementById('quizContainer');
    const passageText = document.getElementById('passageText');
    const questionNumber = document.getElementById('questionNumber');
    const questionText = document.getElementById('questionText');
    const optionsContainer = document.getElementById('optionsContainer');

    const backBtn = document.getElementById('backBtn');
    const nextBtn = document.getElementById('nextBtn');
    const resetBtn = document.getElementById('resetBtn');
    const saveBtn = document.getElementById('saveBtn');
    const submitBtn = document.getElementById('submitBtn');

    const progressBarFill = document.getElementById('progressBarFill');

    const resultScreen = document.getElementById('resultScreen');
    const scoreSummary = document.getElementById('scoreSummary');
    const feedbackList = document.getElementById('feedbackList');
    const downloadPdfBtn = document.getElementById('downloadPdfBtn');

    // Quiz data
    let userName = '';
    let questionsBank = []; // To be filled with 50 questions
    let selectedQuestions = []; // 40 questions per attempt (25 easy, 10 medium, 5 hard)
    let currentQuestionIndex = 0;
    let userAnswers = {}; // {questionId: optionIndex}
    let marksMap = { easy: 1, medium: 2, hard: 3 };

    // Sounds for powerup progress bar steps
    let powerUpSound = new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg');

    // Enable start button only if name entered
    nameInput.addEventListener('input', () => {
      startBtn.disabled = nameInput.value.trim().length === 0;
    });

    // Start button click handler
    startBtn.addEventListener('click', () => {
      userName = nameInput.value.trim();
      if (!userName) return;
      // Play rocket sound
      rocketSound.play();

      // Show quiz container, hide start screen
      startScreen.style.display = 'none';
      quizContainer.style.display = 'flex';

      initQuiz();
    });

    // Initialize Quiz
    function initQuiz() {
      // Load or generate questionsBank here (will be done in Part 2)
      questionsBank = generateQuestionsBank();
function generateQuestionsBank() {
  return [
    // Easy (1 mark each) ‚Äî 25 questions
    {id:1, difficulty:'easy', question:"Where is the narrator waiting for Maggie?", options:["In the yard they made clean and wavy yesterday","In the living room","At the school","Under the sweet gum tree"], correctIndex:0, tip:"Focus on the first sentence of the passage where the yard is mentioned."},
    {id:2, difficulty:'easy', question:"How does Maggie walk after the fire?", options:["With her head held high","Chin on chest, eyes on ground, feet shuffling","Confident and proud","Dancing around the ashes"], correctIndex:1, tip:"Look for the description of Maggie's walking style after the fire."},
    {id:3, difficulty:'easy', question:"Who changed her name to Wangero Leewanika Kemanjo?", options:["Dee","Maggie","Mama","Dicie"], correctIndex:0, tip:"This is explicitly stated by the character herself."},
    {id:4, difficulty:'easy', question:"What color is Maggie's skirt?", options:["Pink","Yellow","Green","Blue"], correctIndex:0, tip:"Look for Maggie's clothing description."},
    {id:5, difficulty:'easy', question:"Who helped raise money to send Dee to school?", options:["The narrator and the church","Wangero","Maggie","Dicie"], correctIndex:0, tip:"Look for who contributed to Dee‚Äôs education."},
    {id:6, difficulty:'easy', question:"What kind of scars does Maggie have?", options:["Burn scars","Cut scars","Bruises","No scars"], correctIndex:0, tip:"Mentioned as burn scars down her arms and legs."},
    {id:7, difficulty:'easy', question:"What question does Maggie ask Mama?", options:["How do I look, Mama?","Are you proud of me?","Will Dee stay?","Why did the house burn?"], correctIndex:0, tip:"Direct quote from Maggie."},
    {id:8, difficulty:'easy', question:"Who stands off under the sweet gum tree?", options:["Dee","Maggie","Mama","Dicie"], correctIndex:0, tip:"Explicitly mentioned in the passage."},
    {id:9, difficulty:'easy', question:"What does Maggie try to do when Dee arrives?", options:["Make a dash for the house","Hide behind the door","Talk to Dee","Run away"], correctIndex:0, tip:"Look for Maggie‚Äôs action on Dee's arrival."},
    {id:10, difficulty:'easy', question:"How long ago was the other house burned?", options:["Ten or twelve years ago","Five years ago","Last year","Yesterday"], correctIndex:0, tip:"Narrator mentions approx. ten or twelve years."},
    {id:11, difficulty:'easy', question:"What is Maggie's posture described as?", options:["Chin on chest, eyes on ground","Head held high","Arms crossed","Looking at Dee"], correctIndex:0, tip:"See description of Maggie‚Äôs posture."},
    {id:12, difficulty:'easy', question:"Who named Dee originally?", options:["Dicie, the narrator's sister","Mama","Maggie","Wangero"], correctIndex:0, tip:"Explicit from the passage."},
    {id:13, difficulty:'easy', question:"What color blouse does Maggie wear?", options:["Red","Blue","Green","Yellow"], correctIndex:0, tip:"Given in the passage."},
    {id:14, difficulty:'easy', question:"Who does Maggie envy and awe?", options:["Her sister Dee","Mama","Dicie","Her friend"], correctIndex:0, tip:"Mentioned directly."},
    {id:15, difficulty:'easy', question:"What is Dee's attitude when reading to them?", options:["Without pity","Kind and gentle","Boring","Loud"], correctIndex:0, tip:"Narrator says Dee reads without pity."},
    {id:16, difficulty:'easy', question:"What did Dee want for her graduation dress?", options:["Yellow organdy dress","Pink skirt","Red blouse","Blue jeans"], correctIndex:0, tip:"Explicit in the passage."},
    {id:17, difficulty:'easy', question:"How does the narrator describe Dee's feet?", options:["Neat-looking, shaped by God","Dirty and tired","Scarred","Burned"], correctIndex:0, tip:"Look for physical description of Dee's feet."},
    {id:18, difficulty:'easy', question:"What did Dee say about her old name?", options:["She couldn't bear it any longer","She loved it","It was perfect","She never mentioned it"], correctIndex:0, tip:"Look for Dee‚Äôs reason for changing name."},
    {id:19, difficulty:'easy', question:"Who tries to dig a well in the sand?", options:["Maggie","Dee","Mama","Dicie"], correctIndex:0, tip:"Maggie's action after being stopped."},
    {id:20, difficulty:'easy', question:"Who does Mama call 'Dicie'?", options:["Her sister","Her daughter","Her friend","A neighbor"], correctIndex:0, tip:"Mentioned clearly in the passage."},
    {id:21, difficulty:'easy', question:"What does Mama say to Maggie when she tries to run?", options:["Come back here","Go away","Stay outside","Don't run"], correctIndex:0, tip:"Look at direct quotes."},
    {id:22, difficulty:'easy', question:"What is Maggie ashamed of?", options:["Her burn scars","Her clothes","Her hair","Her shoes"], correctIndex:0, tip:"Mentioned directly."},
    {id:23, difficulty:'easy', question:"What was Dee determined to do?", options:["Stare down any disaster","Run away","Hide","Leave home"], correctIndex:0, tip:"Narrator‚Äôs description of Dee‚Äôs attitude."},
    {id:24, difficulty:'easy', question:"Who is Wangero in relation to Dee?", options:["Same person, new name","Her friend","Her mother","Her cousin"], correctIndex:0, tip:"Name change explained."},
    {id:25, difficulty:'easy', question:"What kind of dog is Maggie compared to?", options:["Lame animal sidling up to someone kind","Big dog","Fast dog","Hungry dog"], correctIndex:0, tip:"Metaphor about Maggie‚Äôs walk."},

    // Medium (2 marks each) ‚Äî 10 questions
    {id:26, difficulty:'medium', question:"Why does Dee want to change her name?", options:["To reject names of oppressors","To honor her aunt","To sound fancy","To hide her identity"], correctIndex:0, tip:"Look for Dee‚Äôs reason for name change."},
    {id:27, difficulty:'medium', question:"What is the narrator‚Äôs feeling toward the yard?", options:["More comfortable than most people know","Just an ordinary yard","Unpleasant","Scary"], correctIndex:0, tip:"The narrator compares the yard to an extended living room."},
    {id:28, difficulty:'medium', question:"How does the narrator describe Dee's reading to them?", options:["Forcing words, lies, other folks' habits on them","Kind and gentle","Confusing","Funny"], correctIndex:0, tip:"Narrator‚Äôs specific phrase."},
    {id:29, difficulty:'medium', question:"What did Dee want to match with black pumps?", options:["A green suit","A pink blouse","A yellow dress","A red skirt"], correctIndex:0, tip:"Details about Dee‚Äôs graduation outfit."},
    {id:30, difficulty:'medium', question:"What does the narrator imply about Maggie‚Äôs confidence?", options:["She is shy and ashamed","Very confident","Bold and loud","Unaware"], correctIndex:0, tip:"Look for Maggie‚Äôs behavior described in passage."},
    {id:31, difficulty:'medium', question:"What is Mama‚Äôs reaction when Dee announces her new name?", options:["Surprised but accepts","Angry","Happy","Confused"], correctIndex:0, tip:"Dialogue between Mama and Wangero."},
    {id:32, difficulty:'medium', question:"How does the narrator describe Dee‚Äôs ambitions?", options:["Determined to stare down disaster","Lazy and careless","Fearful and nervous","Indifferent"], correctIndex:0, tip:"Narrator‚Äôs insight about Dee."},
    {id:33, difficulty:'medium', question:"Why does the narrator say Dee hated the house?", options:["Because she hated poverty and the house‚Äôs memories","Because it was old","Because Maggie lived there","Because it was too small"], correctIndex:0, tip:"Narrator‚Äôs interpretation of Dee‚Äôs feelings."},
    {id:34, difficulty:'medium', question:"How long does the narrator say it has been since the fire?", options:["Ten to twelve years","Five years","A few months","One year"], correctIndex:0, tip:"Time since the fire given in passage."},
    {id:35, difficulty:'medium', question:"What is the narrator's tone when talking about the fire?", options:["Reflective and somber","Joyful","Angry","Indifferent"], correctIndex:0, tip:"Tone inferred from descriptions."},

    // Hard (3 marks each) ‚Äî 5 questions
    {id:36, difficulty:'hard', question:"What metaphor does the narrator use to describe Maggie's walk?", options:["Like a lame dog sidling up to someone kind","Like a lion stalking prey","Like a bird flying","Like a dancer"], correctIndex:0, tip:"Look for metaphor comparing Maggie‚Äôs movement."},
    {id:37, difficulty:'hard', question:"How does the narrator contrast Maggie and Dee?", options:["Maggie is shy and humble; Dee is confident and ambitious","Both are shy","Both are outgoing","Maggie is ambitious; Dee is shy"], correctIndex:0, tip:"Analyze differences between sisters."},
    {id:38, difficulty:'hard', question:"What does the narrator mean by 'She washed us in a river of make-believe'?", options:["Dee forced them to accept lies and false knowledge","Dee bathed them","Dee took them swimming","Dee told true stories"], correctIndex:0, tip:"Figurative language about Dee‚Äôs reading."},
    {id:39, difficulty:'hard', question:"Why does Dee ‚Äòhate‚Äô the house, according to the narrator?", options:["Because it represents poverty and ignorance","Because it is old","Because it is cold","Because it is far from town"], correctIndex:0, tip:"The house symbolizes things Dee rejects."},
    {id:40, difficulty:'hard', question:"What does the narrator imply about Dee's new name and identity?", options:["It's a rejection of her past and oppression","It is a random choice","It is a family tradition","It is a joke"], correctIndex:0, tip:"Dee explains her new name's significance."},

    // Extra questions to reach 50 total (mixing easy & medium)

    {id:41, difficulty:'easy', question:"What phrase describes Maggie's feet?", options:["Feet in shuffle","Fast feet","Dancing feet","Strong feet"], correctIndex:0, tip:"Check description of Maggie‚Äôs walk."},
    {id:42, difficulty:'easy', question:"What did Mama raise with the church?", options:["Money to send Dee to school","A garden","A house","A party"], correctIndex:0, tip:"Mention of fundraiser with church."},
    {id:43, difficulty:'easy', question:"What is Maggie's body enveloped in?", options:["Pink skirt and red blouse","Blue dress","Yellow coat","Green jacket"], correctIndex:0, tip:"See clothing description."},
    {id:44, difficulty:'easy', question:"How does Maggie feel about her burn scars?", options:["Ashamed","Proud","Indifferent","Happy"], correctIndex:0, tip:"Look at Maggie‚Äôs feelings."},
    {id:45, difficulty:'medium', question:"What does the narrator mean by 'life always in the palm of one hand' about Dee?", options:["Dee seems to control everything easily","Dee is always nervous","Dee is clumsy","Dee is shy"], correctIndex:0, tip:"Figurative speech about Dee‚Äôs life."},
    {id:46, difficulty:'medium', question:"What is the significance of the sweet gum tree?", options:["Place where Dee watches","Where Maggie hides","Where Mama waits","A symbolic tree"], correctIndex:0, tip:"Mentioned where Dee stands watching."},
    {id:47, difficulty:'medium', question:"How does Dee view the people who oppressed her?", options:["She wants to reject them by changing her name","She admires them","She ignores them","She fears them"], correctIndex:0, tip:"Look at Dee‚Äôs reason for name change."},
    {id:48, difficulty:'medium', question:"Why does the narrator mention Dee‚Äôs black pumps?", options:["To show Dee‚Äôs desire for nice things","To mock Dee","To describe Maggie","To describe a gift"], correctIndex:0, tip:"Reflects Dee's ambitions and style."},
    {id:49, difficulty:'medium', question:"What does 'stare down any disaster' imply about Dee?", options:["She is determined and fearless","She is scared","She avoids problems","She runs away"], correctIndex:0, tip:"Interpret this phrase about Dee."},
    {id:50, difficulty:'medium', question:"What is the narrator's relationship with Dee and Maggie?", options:["Mother","Sister","Aunt","Friend"], correctIndex:0, tip:"Narrator refers to herself as 'Mama'."}
  ];
}

      // Select 25 easy, 10 medium, 5 hard questions randomly
      selectedQuestions = [];
      selectedQuestions = selectedQuestions.concat(randomSelect(questionsBank.filter(q => q.difficulty === 'easy'), 25));
      selectedQuestions = selectedQuestions.concat(randomSelect(questionsBank.filter(q => q.difficulty === 'medium'), 10));
      selectedQuestions = selectedQuestions.concat(randomSelect(questionsBank.filter(q => q.difficulty === 'hard'), 5));

      shuffleArray(selectedQuestions);

      currentQuestionIndex = 0;
      userAnswers = {};

      renderQuestion();
      updateControls();
      updateProgressBar();
    }

    // Random select helper
    function randomSelect(arr, count) {
      let copy = arr.slice();
      let result = [];
      while(result.length < count && copy.length > 0) {
        let idx = Math.floor(Math.random() * copy.length);
        result.push(copy.splice(idx,1)[0]);
      }
      return result;
    }

    // Shuffle array helper
    function shuffleArray(arr) {
      for(let i=arr.length-1; i>0; i--) {
        const j = Math.floor(Math.random()*(i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    // Render current question
    function renderQuestion() {
      const q = selectedQuestions[currentQuestionIndex];
      questionNumber.textContent = `Question ${currentQuestionIndex + 1} of ${selectedQuestions.length}`;
      questionText.textContent = q.question;

      optionsContainer.innerHTML = '';
      q.options.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = 'optionBtn';
        btn.textContent = opt;
        btn.type = 'button';
        btn.addEventListener('click', () => {
          userAnswers[q.id] = i;
          highlightSelectedOption(i);
          updateControls();
          updateProgressBar();
          powerUpSound.play();
        });
        optionsContainer.appendChild(btn);
      });

      // Highlight previously selected option if exists
      if (userAnswers[q.id] !== undefined) {
        highlightSelectedOption(userAnswers[q.id]);
      }
    }

    function highlightSelectedOption(selectedIndex) {
      const buttons = optionsContainer.querySelectorAll('button.optionBtn');
      buttons.forEach((btn, i) => {
        btn.classList.toggle('optionSelected', i === selectedIndex);
      });
    }

    // Controls update
    function updateControls() {
      backBtn.disabled = currentQuestionIndex === 0;
      nextBtn.disabled = currentQuestionIndex === selectedQuestions.length - 1 || userAnswers[selectedQuestions[currentQuestionIndex].id] === undefined;

      // Submit button visible only on last question and only if answered
      if (currentQuestionIndex === selectedQuestions.length - 1 && userAnswers[selectedQuestions[currentQuestionIndex].id] !== undefined) {
        submitBtn.style.display = 'inline-block';
        nextBtn.style.display = 'none';
      } else {
        submitBtn.style.display = 'none';
        nextBtn.style.display = 'inline-block';
      }
    }

    // Update progress bar based on number of answered questions
    function updateProgressBar() {
      const answeredCount = Object.keys(userAnswers).length;
      const percent = (answeredCount / selectedQuestions.length) * 100;
      progressBarFill.style.width = `${percent}%`;
    }

    // Button event listeners
    backBtn.addEventListener('click', () => {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion();
        updateControls();
      }
    });
    nextBtn.addEventListener('click', () => {
      if (currentQuestionIndex < selectedQuestions.length - 1 && userAnswers[selectedQuestions[currentQuestionIndex].id] !== undefined) {
        currentQuestionIndex++;
        renderQuestion();
        updateControls();
      }
    });
    resetBtn.addEventListener('click', () => {
      if (confirm('Reset all your answers and restart the quiz?')) {
        userAnswers = {};
        currentQuestionIndex = 0;
        renderQuestion();
        updateControls();
        updateProgressBar();
      }
    });
    saveBtn.addEventListener('click', () => {
      // Save current progress in sessionStorage
      saveProgress();
      alert('Progress saved!');
    });

    submitBtn.addEventListener('click', () => {
      if (!navigator.onLine) {
        alert('You need to be online to submit your quiz. Please check your connection and try again.');
        return;
      }
      if (Object.keys(userAnswers).length < selectedQuestions.length) {
        if (!confirm('Some questions are unanswered. Submit anyway?')) return;
      }
      // Hide quiz, show results
      quizContainer.style.display = 'none';
      showResults();
      resultScreen.style.display = 'block';
    });

    // Save progress to sessionStorage
    function saveProgress() {
      const saveObj = {
        userName,
        selectedQuestions,
        userAnswers,
        currentQuestionIndex
      };
      sessionStorage.setItem('everydayUseQuizProgress', JSON.stringify(saveObj));
    }

    // Load progress if exists
    function loadProgress() {
      const saved = sessionStorage.getItem('everydayUseQuizProgress');
      if (saved) {
        try {
          const obj = JSON.parse(saved);
          if (obj && obj.userName && obj.selectedQuestions && obj.userAnswers) {
            userName = obj.userName;
            selectedQuestions = obj.selectedQuestions;
            userAnswers = obj.userAnswers;
            currentQuestionIndex = obj.currentQuestionIndex || 0;
            return true;
          }
        } catch(e) {
          return false;
        }
      }
      return false;
    }
// Inside the existing JavaScript section

// Function to highlight the selected option and enlarge the button
function highlightSelectedOption(selectedIndex) {
  const buttons = optionsContainer.querySelectorAll('button.optionBtn');
  buttons.forEach((btn, i) => {
    // If selected button, make it blue and enlarge, else revert to normal style
    if (i === selectedIndex) {
      btn.classList.add('optionSelected');
      btn.classList.add('enlarged');  // Add enlarged class for button size change
    } else {
      btn.classList.remove('optionSelected');
      btn.classList.remove('enlarged');
    }
  });
}

// Render current question
function showResults() {
  totalScore = 0;
  maxScore = 0;
  feedbackList.innerHTML = '';  // Clear the previous feedback if any

  selectedQuestions.forEach(q => {
    maxScore += marksMap[q.difficulty];  // Calculate the max score
  });

  // Loop through each question to display results
  selectedQuestions.forEach((q, index) => {
    const userAns = userAnswers[q.id];  // Get the user's answer
    const correct = userAns === q.correctIndex;  // Check if the answer is correct
    if (correct) {
      totalScore += marksMap[q.difficulty];  // Add score for correct answer
    }
    // ...
    

    // Create wrapper div
    const fbItem = document.createElement('div');
    fbItem.className = 'feedbackItem ' + (correct ? 'correct' : 'incorrect');

    // Question text
    const qText = document.createElement('p');
    qText.innerHTML = `<strong>Q${index + 1}:</strong> ${q.question}`;
    fbItem.appendChild(qText);

    // User's answer
    const userAnswerText = document.createElement('p');
    userAnswerText.innerHTML = `<em>Your answer:</em> ${q.options[userAns] ?? "No answer"}`;
    fbItem.appendChild(userAnswerText);

    const feedbackText = document.createElement('p');
if (correct) {
  feedbackText.textContent = `Question ${index + 1}: ‚úÖüéâ Congratulations, that is Correct`;
} else {
  feedbackText.textContent = `Question ${index + 1}: ‚ùå Incorrect - Tip: ${q.tip}`;
}
fbItem.appendChild(feedbackText);

    // Feedback tip if incorrect
    if (!correct) {
      const tipText = document.createElement('p');
      tipText.style.color = 'red';
      tipText.innerHTML = `<strong>Tip:</strong> ${q.tip}`;
      fbItem.appendChild(tipText);
    }

    feedbackList.appendChild(fbItem);
  });

  // Calculate percentage and grade
  const percent = Math.round((totalScore / maxScore) * 100);
  let grade = '';
  if (percent >= 85) grade = 'A';
  else if (percent >= 70) grade = 'B';
  else if (percent >= 50) grade = 'C';
  else if (percent >= 30) grade = 'D';
  else if (percent >= 21) grade = 'E';
  else grade = 'F';

  // Show summary
  scoreSummary.innerHTML = `
    Mr. King's grading system has scored your quiz.<br><br>
    <strong>${userName}</strong>, your score is <strong>${totalScore} / ${maxScore}</strong> (${percent}%).<br>
    Your letter grade is: <strong>${grade}</strong>.
  `;

  // Store for PDF use
  window.quizSummary = { totalScore, maxScore, percent, grade };
}

downloadPdfBtn.addEventListener('click', () => {
  console.log('Download PDF button clicked');
  generatePDFReport();
});


function generatePDFReport() {
  const doc = new jsPDF();
  const margin = 15;
  let y = margin;

  // Title of the report
  doc.setFont('helvetica', 'bold');
  doc.setFontSize(16);
  doc.text("Everyday Use Quiz Report", margin, y);
  y += 10;
  
  // Student Name
  doc.setFont('helvetica', 'normal');
  doc.setFontSize(15);
  doc.text(`Student Name: ${userName}`, margin, y);
  y += 10;

  // Score summary
  doc.text(`Your score: ${totalScore} / ${maxScore}`, margin, y);
  y += 12;

  // Add each question + answer + feedback
  selectedQuestions.forEach((q, i) => {
    if (y > 270) {  // Add new page if content exceeds
      doc.addPage();
      y = margin;
    }

    // Question text
    doc.setFont('helvetica', 'bold');
    doc.text(`Q${i + 1}: ${q.question}`, margin, y);
    y += 7;

    // Options
    doc.setFont('helvetica', 'normal');
    q.options.forEach((opt, idx) => {
      let prefix = '  ';
      if (idx === q.correctIndex) prefix = '‚úî ';  // Correct answer
      if (userAnswers[q.id] === idx && userAnswers[q.id] !== q.correctIndex) prefix = '‚úò ';  // Incorrect answer

      doc.text(`${prefix}${opt}`, margin + 5, y);
      y += 6;
    });

    // Feedback for incorrect answers
    if (userAnswers[q.id] !== q.correctIndex) {
      doc.setFont('helvetica', 'italic');
      doc.setTextColor(255, 0, 0);
      doc.text(`Tip: ${q.tip}`, margin + 8, y);
      doc.setTextColor(0, 0, 0); // Reset color
      y += 8;
    }

    y += 5;  // Add space before next question
  });

  // Save the PDF
  doc.save(`EverydayUseQuizReport_${userName.replace(/\s+/g, '_')}.pdf`);
}


  })();
</script>

</body>
</html>
